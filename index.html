<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Declaration of the Daves - Sign the Contract</title>

  <!-- Allow embedding in iframes -->
  <meta http-equiv="X-Frame-Options" content="ALLOWALL" />

  <!-- Perf for ESM CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- Reown/AppKit (ESM over CDN) â€” no top-level await; long readiness window; resilient provider polling -->
  <script type="module">
    window.__appkitReady = false;
    (async () => {
      try {
        // Load modules (single source). Using +esm keeps the tree small and consistent across WebKit.
        const appkitMod   = await import("https://cdn.jsdelivr.net/npm/@reown/appkit/+esm");
        const networksMod = await import("https://cdn.jsdelivr.net/npm/@reown/appkit/networks/+esm");
        const adapterMod  = await import("https://cdn.jsdelivr.net/npm/@reown/appkit-adapter-ethers5/+esm");

        const { createAppKit } = appkitMod;
        const { base } = networksMod;
        const { Ethers5Adapter } = adapterMod;

        const modal = await createAppKit({
          adapters: [new Ethers5Adapter()],
          networks: [base],
          defaultNetwork: base,
          projectId: "c6e735ab923e4817edde143987bdfccf",
          themeMode: "dark",
          features: { analytics: false },
          metadata: {
            name: "Declaration of the Daves",
            description: "Sign the declaration on Base",
            url: "https://connect.thebanksy.house",
            icons: ["https://connect.thebanksy.house/icon.png"]
          }
        });

        // Expose a minimal modal API globally for non-module script
        window.daveModal = modal;
        window.__appkitReady = true;
      } catch (e) {
        console.error("AppKit init failed", e);
        window.__appkitReady = false;
        window.__appkitError = (e && (e.message || e.toString())) || "unknown";
      }
    })();
  </script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --bg:#0d1117; --panel:#161b22; --border:#30363d; --muted:#8b949e;
      --accent:#58a6ff; --green:#7ee787; --pink:#f78166; --text:#c9d1d9;
      --white:#f0f6fc; --blue:#1f6feb;
    }
    body {
      background:var(--bg); color:var(--text); font-family:'JetBrains Mono', monospace;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:20px; padding-top: calc(20px + env(safe-area-inset-top));
    }
    .widget-container { max-width:600px; margin:0 auto; width:100%; }

    /* Main contract container (desktop/tablet keeps square look) */
    .contract-container {
      background:var(--panel); border:1px solid var(--border); border-radius:6px; width:100%;
      aspect-ratio:1; overflow:hidden; display:flex; flex-direction:column;
    }

    .contract-header {
      background:var(--bg); border-bottom:1px solid var(--border); padding:12px 20px;
      display:flex; align-items:center; gap:8px; min-width:0;
    }
    .file-icon{ color:var(--green); flex:0 0 auto; }
    .filename{
      color:var(--white); font-size:14px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; min-width:0;
    }
    .network-badge{
      margin-left:auto; background:var(--blue); color:#fff; padding:4px 12px; border-radius:20px; font-size:12px;
      white-space:nowrap; flex:0 0 auto; align-self:center; line-height:1;
    }

    .code-editor{ flex:1; position:relative; display:flex; align-items:center; padding:40px 0; }
    .line-numbers{
      position:absolute; left:20px; top:50%; transform:translateY(-50%);
      width:30px; text-align:right; color:#484f58; font-size:12px; line-height:20px; user-select:none;
    }
    .code-content{
      margin-left:70px; margin-right:40px; font-size:12px; line-height:20px; width:calc(100% - 110px);
      overflow-wrap:anywhere; word-break:break-word;
    }

    /* Syntax highlighting */
    .comment{ color:var(--muted); font-style:italic; }
    .keyword{ color:#ff7b72; }
    .function-name{ color:#d2a8ff; }
    .type{ color:#79c0ff; }
    .string{ color:#a5d6ff; }
    .parameter{ color:#ffa657; }
    .address{ color:var(--green); font-size:12px; word-break:break-word; font-family:'JetBrains Mono', monospace; }
    .number{ color:#79c0ff; }

    /* Input styling */
    .input-line{
      background:var(--bg); border:1px solid var(--border); border-radius:4px; padding:8px 12px; margin:8px 0;
      display:inline-flex; align-items:center; transition:border-color .2s; white-space:nowrap;
    }
    .input-line:hover{ border-color:var(--accent); }
    .input-line.focused{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(88,166,255,.1); }
    .input-line.disabled{ opacity:.5; cursor:not-allowed; }
    .input-prefix,.input-suffix{ color:#a5d6ff; font-size:12px; }
    .name-input{ background:none; border:none; color:#a5d6ff; font-family:inherit; font-size:12px; outline:none; width:140px; margin:0 4px; }

    /* Mobile minimal input block */
    .mobile-only{ display:none; }
    .desktop-only{ display:inline-block; }
    .mobile-shell{
      background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:12px 16px; margin:8px 0;
      display:flex; align-items:center; gap:6px;
    }
    .quote{ color:#a5d6ff; }
    .name-input-mobile{ background:none; border:none; color:#a5d6ff; font-family:inherit; font-size:14px; outline:none; width:100%; }
    /* Flashing cursor for mobile minimal input */
    .mobile-caret{
      width:6px; height:1.1em; background:#a5d6ff; display:inline-block; border-radius:1px;
      animation:blink 1s steps(1,end) infinite;
    }
    .mobile-shell:focus-within .mobile-caret{ opacity:0; }
    @keyframes blink { 50% { opacity:0; } }

    /* Preview section */
    .preview-comment{ margin-top:16px; padding:8px; background:var(--bg); border-radius:4px; font-size:12px; }
    .preview-comment .comment, .preview-comment .string{ font-size:12px; }

    /* Action section */
    .action-section{
      background:var(--bg); border-top:1px solid var(--border); padding:20px;
      display:flex; align-items:center; justify-content:space-between; gap:16px; min-width:0;
    }
    .contract-info{ font-size:12px; min-width:0; flex:1 1 auto; }
    .contract-label{ color:var(--muted); margin-bottom:4px; }
    .contract-address-link{ color:var(--green); text-decoration:none; transition:opacity .2s; display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .contract-address-link:hover{ opacity:.8; text-decoration:underline; }

    .execute-button{
      background:var(--pink); color:var(--bg); border:none; padding:10px 24px; border-radius:6px;
      font-family:inherit; font-size:14px; font-weight:600; cursor:pointer; transition:all .2s;
      text-transform:uppercase; letter-spacing:.5px; white-space:nowrap; flex:0 0 auto;
    }
    .execute-button:hover:not(:disabled){ background:#ff8c73; transform:translateY(-1px); }
    .execute-button:active:not(:disabled){ transform:translateY(0); }
    .execute-button:disabled{ opacity:.6; cursor:not-allowed; }

    /* Connected status */
    .wallet-status{ position:absolute; top:20px; right:20px; font-size:12px; color:var(--green); display:none; align-items:center; gap:6px; }
    .wallet-status.connected{ display:flex; }
    .status-dot{ width:8px; height:8px; background:var(--green); border-radius:50%; animation:pulse 2s infinite; }
    @keyframes pulse{ 0%{opacity:1} 50%{opacity:.5} 100%{opacity:1} }

    /* Error state */
    .error-message{ background:#f85149; color:#fff; padding:8px 12px; border-radius:4px; font-size:12px; margin:8px 0; display:none; }
    .error-message.show{ display:block; }

    /* NFT Preview - must remain square */
    .nft-container{
      background:var(--panel); border:1px solid var(--border); border-radius:6px; width:100%;
      aspect-ratio:1; margin:40px auto 20px; display:none; align-items:center; justify-content:center;
    }
    .nft-container.show{ display:flex; }
    .nft-code-editor{ position:relative; width:100%; padding:40px 0; }
    .nft-line-numbers{
      position:absolute; left:20px; top:50%; transform:translateY(-50%);
      width:30px; text-align:right; color:#484f58; font-size:12px; line-height:20px; user-select:none;
    }
    .nft-code-content{ margin-left:70px; margin-right:40px; font-size:12px; line-height:20px; overflow-wrap:anywhere; word-break:break-word; }

    /* Mint button */
    .mint-button-container{ text-align:center; margin-bottom:40px; display:none; }
    .mint-button-container.show{ display:block; }
    .mint-button{
      background:var(--pink); color:var(--bg); border:none; padding:10px 24px; border-radius:6px;
      font-family:inherit; font-size:14px; font-weight:600; cursor:pointer; transition:all .2s;
      text-transform:uppercase; letter-spacing:.5px;
    }
    .mint-button:hover:not(:disabled){ background:#ff8c73; transform:translateY(-1px); }
    .mint-button:disabled{ opacity:.6; cursor:not-allowed; }
    .loading-spinner{ display:inline-block; width:14px; height:14px; border:2px solid var(--bg); border-radius:50%; border-top-color:transparent; animation:spin .8s linear infinite; margin-left:8px; vertical-align:middle; }
    @keyframes spin{ to{ transform:rotate(360deg); } }

    /* Success message */
    .success-message{ background:#238636; color:#fff; padding:12px; border-radius:6px; font-size:12px; margin:20px 0; text-align:center; display:none; }
    .success-message.show{ display:block; }
    .success-message a{ color:var(--green); text-decoration:none; }
    .success-message a:hover{ text-decoration:underline; }

    /* -------- Mobile fixes -------- */
    @media (max-width: 600px) {
      body { padding-top: calc(20px + env(safe-area-inset-top)); }

      .contract-container { aspect-ratio:auto; height:auto; overflow:visible; border-radius:0; }

      .code-editor { align-items:flex-start; padding:24px 0 16px; }
      .line-numbers { top:24px; transform:none; }

      .desktop-only{ display:none; }
      .mobile-only{ display:block; }

      .code-content { font-size:11px; }
      .name-input   { font-size:11px; width:120px; }

      /* Lock action row so the button cannot overflow */
      .action-section {
        display:grid;
        grid-template-columns: 1fr auto;
        align-items:center;
        gap:10px;
      }
      .contract-info { min-width:0; }
      .contract-address-link { display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
      .execute-button { white-space:nowrap; font-size:12px; padding:8px 14px; max-width:45vw; }

      .network-badge { font-size:11px; padding:3px 10px; }
    }

    /* Ensure NFT preview is always square */
    .nft-container { aspect-ratio: 1; }
  </style>
</head>
<body>
  <div class="widget-container">
    <!-- Main Widget -->
    <div class="contract-container">
      <!-- Header -->
      <div class="contract-header">
        <span class="file-icon">ðŸ“„</span>
        <span class="filename">DeclarationOfTheDaves.sol</span>
        <span class="network-badge">Base Mainnet</span>
      </div>

      <!-- Wallet Status -->
      <div class="wallet-status" id="walletStatus">
        <span class="status-dot"></span>
        <span id="walletAddress">Connected</span>
      </div>
